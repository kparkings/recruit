<div class="page">

	<!-- Nav options -->
	<div class="nav-tabs-bar" *ngIf="isAuthenticated()"></div>

	<div class="page-body">
		<div [ngSwitch]="activeView">
		
		<div class="action-buttons" *ngSwitchCase="'list'">
			<button class="btn btn-secondary arenella-btn listing-main-action-button" (click)="openCreateAlertDialog()" *ngIf="!isAuthenticated() || isAuthenticated() && isCandidate()">{{'arenella-listing-btn-create' | translate}}</button>
			<button class="btn btn-secondary arenella-btn listing-main-action-button" routerLink="/recruiter-listings" *ngIf="isAuthenticated() && !isAuthenticatedAsAdmin() && !isCandidate()">{{'arenella-listing-btn-your-posts' | translate}}</button>
		</div>
	
		<div>
			<div class="{{searchBarCss}} arenella-whole-width-page">
				<app-searchbarlisting #searchbar (newListingResults)="handleNewSearchRequest($event)"></app-searchbarlisting>
			</div>
				
		    <!-- List View -->
		    <div *ngSwitchCase="'list'">
				
		       	<!-- Listings Table -->
				<div>
				
					<div class="listing-pane" >
					
						<div class="listing-pane-left non-mobile-only-element">
							
							<table class="listing-stats-pane" style="table-layout: fixed">
								<tr style="padding-bottom:20px;">
									<td colspan="2" style="padding-top:20px;padding-bottom:20px;">
										<span style="font-weight:bold;">{{'arenella-listing-most-searched-countries' | translate}}</span>
									</td>
								</tr>
								<tr *ngFor="let stat of stats.countryStats">
									<td style="width:150px;font-size:14px;">{{stat.country | translate}}</td>
									<td style="padding-left:5px;width:180px;">
										<div class="stat-option-bar" [ngStyle]="{'width':(stat.percentageOfTotal/highestCountryPerc*100)+'%','background':'#adb5bd', 'max-width':'180px'}">
										</div>
									</td>
								</tr>
								<tr>
									<td colspan="2" style="padding-top:20px;padding-bottom:20px;">
										<span style="font-weight:bold;padding-top:20px;">{{'arenella-listing-most-searched-functions' | translate}}</span>
									</td>
								</tr>
								<tr *ngFor="let stat of stats.functionStats">
									<td style="width:150px;font-size:14px;">{{(stat.function) | translate}}</td>
									<td style="padding-left:5px;width:180px;">
										<div class="stat-option-bar" [ngStyle]="{'width':(stat.percentageOfTotal/highestFunctionPerc*100)+'%','background':'#adb5bd', 'max-width':'180px'}">
										</div>
									</td>
									
								</tr>
								
							</table>
							
							<div class="listing-stats-pane">
								<p>
								{{'arenella-listing-most-searched-summary' | translate}}
								</p>
							</div>
						</div>
						
						<div class="listing-pane-right">
						
							<div class="job-post" *ngFor="let listing of listings" id="{{listing.listingId}}">
								<div (click)="showListingDetails(listing)">
									<div class="listing-title">
										<a style="color:#002549;" href="{{getExternalUrl(listing.listingId)}}" (click)="handleClick($event)" id="{{getFormattedJobTitle(listing.title)}}" title="{{getFormattedJobTitle(listing.title)}}">
											{{getFormattedJobTitle(listing.title)}}
										</a>
										<span class="non-mobile-only-element contract-type-listing">{{getContractType(listing.type)}}</span>
									</div>
									<div class="listing-country ">
										<table class="non-mobile-only-element" style="width:500px;">
											<tr>
												<td style="width:500px;">
													<span class="non-mobile-only-element listing-country-title"  style="float:left">{{listing.country | translate}}</span>
													<span class="non-mobile-only-element"  style="float:left;margin-left:10px;">{{listing.location}}</span>
												</td> 
											</tr>
											
										</table>
										<table class="mobile-only-element">
											<tr>
											<tr>
												<td>
													<span title="{{listing.listingId}}" class="flag-icon flag-icon-{{getCountryISO2Code(listing.country)}} suggestion-flag-country listing-country mobile-only-element"></span>
												</td> 
											</tr>
										</table>
									</div>
									<div class="job-post-contract-type mobile-only-element">
										{{getContractType(listing.type)}}
									</div>
									<div class="non-mobile-only-element">
										<table class="listing-view-table">
											<tr>
												<th>{{'listings-views' | translate}}</th>
												<td>{{listing.views}}</td>
												<th>{{'listings-applications' | translate}}</th>
												<td>{{getContactRequestStatForListing(listing.listingId).registeredUserRequests + getContactRequestStatForListing(listing.listingId).unregisteredUserRequests}}</td>
											</tr>
										</table>
									</div>
									<div>
										<a href="{{getExternalUrl(listing.listingId)}}"></a>
									</div>
									
								</div>
							</div>
						</div>
						
						
					</div>
				</div>
			</div>
			
		</div>
		
		<!-- Show Selected Listing View -->
		<div>
			<div  *ngSwitchCase="'show'">
	       		<!-- Action buttons -->
				<div class="action-buttons">
					<button class="btn btn-secondary arenella-btn" (click)="showPublicity()">{{'arenella-listing-btn-publicity' | translate}}</button>
					<button (click)="showList()" class="btn btn-secondary arenella-btn">{{'arenella-listing-btn-back' | translate}}</button>
				</div>
				
				<app-candidate-info-box [config]="infoItemConfig"></app-candidate-info-box>
				
				<div>
	       			
	       			<div class="desc-body">
			       		<h1 class="listing-view-title">{{selectedListing.title}}</h1>
			       		<div>
							<div>
								<pre style="white-space:pre-line;font-family: Roboto, 'Helvetica Neue', sans-serif;">{{selectedListing.description}}</pre>
							</div>
							<div class="mobile-only-element contact-recruiter-header">
								<h1>{{'arenella-listing-contact-recruiter' | translate}}</h1>
							</div>
							<div *ngIf="!isCandidate()" style="min-width:75%">
								<form [formGroup]="emailRequestFormBean">
									<div>
										<p class="email-label">{{'arenella-listing-your-name' | translate}}:</p>
										<input class="email-input" type="email" formControlName="name">
									</div>
									<div>
										<p class="email-label">{{'arenella-listing-your-email' | translate}}:</p>
										<input class="email-input" type="email" formControlName="email">
									</div>
									<p class="email-label">{{'arenella-listing-message-to-recruiter' | translate}}</p>
									<textarea class="contact-recruiter-textarea" formControlName="message"></textarea>
									<div class="div-spacing">
										<p class="email-label">{{'arenella-listing-curriculum' | translate}}</p>
										<input class="email-input" type="file" (change)="uploadCurriculumFile($event)"> 
										<div style="margin-top:10px">{{'arenella-listing-your-doc-types' | translate}}</div>
									</div>
										<div class="action-buttons">
											<button class="btn btn-secondary arenella-btn contact-recruiter-btn" (click)="sendEmailRequest()" *ngIf="enableSendEmail()">{{'arenella-listing-btn-send' | translate}}</button>
											<button class="btn btn-secondary arenella-btn contact-recruiter-btn" disabled *ngIf="!enableSendEmail()">{{'arenella-listing-btn-send' | translate}}</button>
										</div>
								</form>
							</div>
							<div *ngIf="isCandidate()" style="min-width:75%">
								<form [formGroup]="emailRequestFormBean">
									<p class="email-label">{{'arenella-listing-messate-to-recruiter' | translate}}</p>
									<textarea class="contact-recruiter-textarea" formControlName="message"></textarea>
									<div class="div-spacing">
										<p class="email-label">{{'arenella-listing-curriculum' | translate}}</p>
										<div *ngIf="!curriculumFile">
											<br>
											<input type="checkbox" disabled="disabled" checked><span>{{'arenella-listing-use-stored-cv' | translate}}</span>
											<br><br>
											<p>Or</p>
										</div>
										<input class="email-input" name="selected-file" type="file" (change)="uploadCurriculumFile($event)"> 
										<div style="margin-top:10px">{{'arenella-listing-your-doc-types' | translate}}</div>
									</div>
									<div class="action-buttons">
										<button class="btn btn-secondary arenella-btn contact-recruiter-btn" (click)="sendEmailRequest()" *ngIf="enableSendEmail()">{{'arenella-listing-btn-send' | translate}}</button>
										<button class="btn btn-secondary arenella-btn contact-recruiter-btn" disabled *ngIf="!enableSendEmail()">{{'arenella-listing-btn-send' | translate}}Send</button>
									</div>
								</form>
							</div>
		       			</div>
		       		</div>
				</div>
			</div>
		</div>
	</div>
</div>
</div>

<!-- Feedback Box -->
<dialog #feedbackBox>
	<div class="modal-header">
		<h4 class="modal-title">{{'arenella-listing-feedback-title' | translate}}</h4>
 		<div class="filter-close-box" (click)="feedbackBox.close()">X</div>
	</div>
	<div class="feedbackBox;">
		<div class="modal-body" *ngIf="showSendAlertBoxSuccess">
			<p>{{'arenella-listing-feedback-msg1' | translate}}</p>
			<p>{{'arenella-listing-feedback-msg2' | translate}}</p>
		</div>
		<div class="modal-body" *ngIf="showSendAlertBoxFailure">
			<p>{{'arenella-listing-feedback-failure' | translate}}</p>
		</div>
	</div>
</dialog>
<!-- Publicity Box -->
<dialog #publicityBox>
	<div class="modal-header">
		<h4 class="modal-title">{{'arenella-listing-publicity' | translate}}</h4>
 		<div class="filter-close-box" (click)="publicityBox.close()">X</div>
	</div>
	<div class="feedbackBox;">
	
		<div *ngIf="isAuthenticated() && (isAuthenticatedAsRecruiter() || isAuthenticatedAsAdmin())">
			<div class="modal-body"  style="height:400px;">
				<p>{{'arenella-listing-publicity-open-position' | translate}}: {{selectedListing.title}}</p>
				<br>
				<p>{{'arenella-listing-publicity-location' | translate}}: {{selectedListing.country}}</p>
				<br>
				<p>https://www.arenella-ict.com/listing/{{selectedListing.listingId}}</p>
				<br>
				<span>#openposition </span>
				<span>#itjob </span>
				<span>#itjobs </span>
				<span>#ictbaan </span>
				<span>#ictbanen </span>
				<span>#itjobboard </span>
				<span>#cvdatabase </span>
				<span *ngFor="let skill of selectedListing.skills">#{{stripSkillWhitepace(skill)}} </span>
			</div>
		</div>
		
		<div *ngIf="!isAuthenticated() || isAuthenticatedAsCandidate()">
			<div class="modal-body share-post">
				<h2>URL</h2>
				
				<p>{{'arenella-listing-share-popup-text' | translate}}</p>
				<p class="share-post-url">https://www.arenella-ict.com/listing/{{selectedListing.listingId}}</p>
			</div>
			<div class="share-post-clipboard"> 
				<button class="btn btn-secondary arenella-btn clipboard-btn" (click)="copyURLToClipboard(selectedListing.listingId)">{{'arenella-listing-share-copy-to-clipboard' | translate}}</button>
				<p *ngIf="postPublicityUrlCopiedTClipbard" class="share-post-clipboard-text">{{'arenella-listing-share-copied-to-clipboard' | translate}}</p>
			</div>	
		</div>
	</div>
</dialog>
<!-- Listing Alert Box -->
<dialog #listingAlertBox>
	<div class="modal-header">
		<h4 class="modal-title">{{'arenella-listing-email-alert' | translate}}</h4>
 		<div class="filter-close-box" (click)="listingAlertBox.close()">X</div>
	</div>
	<div class="feedbackBox;">
		<form [formGroup]="alertFormBean">
			<div class="modal-body">
				<div *ngIf="createAlertStep == 0">
					<P>{{'arenella-listing-email-alert-1' | translate}}</P>
					<select formControlName="contractType">
						<option *ngFor="let type of contractTypeOptions" [ngValue]="type.value">{{type.label | translate}}</option>
					</select>
				</div>
				<div *ngIf="createAlertStep == 1">
					<P>{{'arenella-listing-email-alert-2' | translate}}</P>
					<div class="alert-options center">
						<div class="listing-alert-option {{selectedFunctionTypeCss(sft)}}" *ngFor="let sft of selectableFunctionTypes" (click)="toggleFunctionType(sft)">{{sft.functionType.humanReadable}}</div>
					</div>
				</div>
				<div *ngIf="createAlertStep == 2">
				
				
					<P>{{'arenella-listing-email-alert-3' | translate}}</P>
					
					<div class="alert-options center">
						<div class="country-selections">
							<span class="country-filter country-selected-{{selectedCountryCss(sc)}}" *ngFor="let sc of selectableCountries" (click)="toggleCountry(sc)">
								<span class="country-flag flag-icon flag-icon-{{sc.country.iso2Code}} " title="{{sc.country.humanReadable}}"></span>
							</span>
						</div>
					</div>
					
				</div>
				<div *ngIf="createAlertStep == 3">
						<div>
						<b style="margin-right:10px;">{{'arenella-listing-email-alert-email' | translate}}:</b><input type="email" formControlName="emailAddress" (keyup)="handleAlertEmailOnChange()"/>
					</div>
				</div>
				<div *ngIf="createAlertStep == 4">
					<div style="margin-top:0px;">
						<h1>{{'arenella-listing-email-alert-created' | translate}}</h1>
					</div>
				</div>
				<div style="clear:both; padding-top:20px;" >
					<button *ngIf="createAlertStep != 0 && createAlertStep != 4" class="btn btn-secondary arenella-btn" (click)="createListingAlertLastStep()">{{'arenella-listing-email-alert-btn-back' | translate}}</button>
					<button *ngIf="createAlertStep != 3 && createAlertStep != 4" class="btn btn-secondary arenella-btn" (click)="createListingAlertNextStep()">{{'arenella-listing-email-alert-btn-next' | translate}}</button>
					<button *ngIf="createAlertStep == 3" 						 class="btn btn-secondary arenella-btn" [disabled]="listingAlertConfirmDisabled" (click)="createListingAlert()">{{'arenella-listing-email-alert-btn-confirm' | translate}}</button>
				</div>
			</div>	
		</form>
	</div>
</dialog>